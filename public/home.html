<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HOME | SMART NOTICE BOARD</title>
<style>
/* ============================================
   COMPLETE HOME PAGE CSS - EMBEDDED
   Live Display Preview & Interactive Filters
   ============================================ */

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
}

/* ===== TOP HEADER ===== */
.top-header {
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    color: white;
    padding: 15px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
}

.top-header h1 {
    font-size: 20px;
    font-weight: 600;
}

.header-controls {
    display: flex;
    align-items: center;
    gap: 15px;
}

.refresh-btn {
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid white;
    color: white;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    font-size: 13px;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 8px;
}

.refresh-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-2px);
}

.user-info {
    display: flex;
    align-items: center;
    gap: 12px;
    background: rgba(255, 255, 255, 0.1);
    padding: 8px 15px;
    border-radius: 8px;
}

.user-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 16px;
}

.user-name {
    font-size: 14px;
    font-weight: 600;
}

.user-role {
    font-size: 11px;
    opacity: 0.8;
}

/* ===== LAYOUT ===== */
.layout {
    display: flex;
    max-width: 1920px;
    margin: 0 auto;
}

/* ===== SIDEBAR ===== */
.sidebar {
    width: 260px;
    background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
    padding: 25px 0;
    box-shadow: 4px 0 10px rgba(0, 0, 0, 0.3);
    min-height: calc(100vh - 70px);
}

.sidebar a {
    display: flex;
    align-items: center;
    gap: 12px;
    color: #cbd5e1;
    text-decoration: none;
    padding: 16px 28px;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.3s ease;
    border-left: 4px solid transparent;
}

.sidebar a:hover {
    background-color: rgba(59, 130, 246, 0.1);
    color: white;
    border-left-color: #3b82f6;
    padding-left: 32px;
}

.sidebar a.active {
    background: linear-gradient(90deg, rgba(59, 130, 246, 0.2) 0%, transparent 100%);
    color: white;
    border-left-color: #60a5fa;
}

.sidebar-icon {
    font-size: 18px;
    width: 24px;
}

/* ===== PAGE CONTENT ===== */
.page-content {
    flex: 1;
    padding: 20px;
}

/* ===== SECTION ===== */
.section {
    background: white;
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 20px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

.section-title {
    font-size: 18px;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid #e2e8f0;
    display: flex;
    align-items: center;
    gap: 10px;
}

/* ===== FILTER CONTROLS ===== */
.filter-section {
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 20px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

.filter-title {
    font-size: 16px;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.filter-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 15px;
}

.filter-group {
    display: flex;
    flex-direction: column;
}

.filter-label {
    font-size: 13px;
    font-weight: 600;
    color: #475569;
    margin-bottom: 8px;
    text-transform: uppercase;
}

.filter-select {
    padding: 12px;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    color: #1e293b;
    background: white;
    cursor: pointer;
    transition: all 0.3s;
}

.filter-select:hover {
    border-color: #3b82f6;
}

.filter-select:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

/* ===== LIVE DISPLAY PREVIEW ===== */
.display-preview-container {
    background: #0f172a;
    border-radius: 12px;
    padding: 20px;
    min-height: 500px;
    position: relative;
    overflow: hidden;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
}

.display-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 2px solid rgba(255, 255, 255, 0.1);
}

.display-name {
    font-size: 16px;
    font-weight: 700;
    color: white;
}

.display-status {
    display: flex;
    align-items: center;
    gap: 8px;
}

.status-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    animation: pulse 2s infinite;
}

.status-online {
    background: #10b981;
    box-shadow: 0 0 10px #10b981;
}

.status-offline {
    background: #ef4444;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.status-text {
    font-size: 13px;
    font-weight: 600;
    color: white;
}

.display-frame {
    background: white;
    border-radius: 8px;
    min-height: 400px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
}

.display-content {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px;
    text-align: center;
}

.content-placeholder {
    font-size: 48px;
    margin-bottom: 20px;
}

.content-title {
    font-size: 32px;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 15px;
}

.content-description {
    font-size: 18px;
    color: #64748b;
    max-width: 600px;
}

.display-info-bar {
    display: flex;
    gap: 20px;
    margin-top: 15px;
    padding: 15px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
}

.info-item {
    display: flex;
    align-items: center;
    gap: 8px;
    color: white;
    font-size: 13px;
}

.info-label {
    color: #94a3b8;
}

.info-value {
    font-weight: 600;
}

/* ===== UPCOMING SCHEDULE ===== */
.schedule-table-container {
    overflow-x: auto;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
}

.schedule-table {
    width: 100%;
    border-collapse: collapse;
}

.schedule-table thead {
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
}

.schedule-table th {
    padding: 12px 15px;
    text-align: left;
    font-size: 13px;
    font-weight: 600;
    color: #475569;
    border-bottom: 2px solid #e2e8f0;
    text-transform: uppercase;
}

.schedule-table td {
    padding: 12px 15px;
    font-size: 14px;
    color: #1e293b;
    border-bottom: 1px solid #f1f5f9;
}

.schedule-table tbody tr {
    transition: all 0.3s;
    cursor: pointer;
    position: relative;
}

.schedule-table tbody tr:hover {
    background: #f8fafc;
    transform: scale(1.01);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.time-badge {
    background: #dbeafe;
    color: #1e40af;
    padding: 6px 12px;
    border-radius: 6px;
    font-weight: 600;
    font-size: 13px;
    display: inline-block;
}

.content-name {
    font-weight: 600;
    color: #1e293b;
}

.content-category {
    font-size: 12px;
    color: #64748b;
    margin-top: 3px;
}

.posted-by {
    display: flex;
    align-items: center;
    gap: 8px;
}

.poster-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 12px;
}

.priority-badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
}

.priority-emergency {
    background: #fee2e2;
    color: #991b1b;
}

.priority-important {
    background: #fef3c7;
    color: #92400e;
}

.priority-normal {
    background: #dbeafe;
    color: #1e40af;
}

/* ===== STATS CARDS ===== */
.stats-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 15px;
    margin-bottom: 20px;
}

.stat-card {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    border-radius: 12px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 15px;
    border: 2px solid #e2e8f0;
    transition: all 0.3s;
    cursor: pointer;
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    border-color: #3b82f6;
}

.stat-icon {
    font-size: 36px;
}

.stat-content {
    flex: 1;
}

.stat-value {
    font-size: 28px;
    font-weight: 700;
    color: #1e293b;
    line-height: 1;
    margin-bottom: 5px;
}

.stat-label {
    font-size: 13px;
    color: #64748b;
    font-weight: 500;
}

/* ===== NO DATA STATE ===== */
.no-data {
    text-align: center;
    padding: 60px 20px;
    color: #94a3b8;
}

.no-data-icon {
    font-size: 64px;
    margin-bottom: 20px;
    opacity: 0.5;
}

.no-data-text {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 10px;
}

.no-data-subtext {
    font-size: 14px;
}

/* ===== FOOTER ===== */
.footer {
    text-align: center;
    padding: 20px;
    color: white;
    font-size: 13px;
    margin-top: 30px;
}

/* ===== RESPONSIVE ===== */
@media (max-width: 1400px) {
    .filter-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    .stats-row {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .filter-grid {
        grid-template-columns: 1fr;
    }
    .stats-row {
        grid-template-columns: 1fr;
    }
    .layout {
        flex-direction: column;
    }
    .sidebar {
        width: 100%;
        min-height: auto;
    }
}

/* ===== LOADING ANIMATION ===== */
.loading {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 40px;
}

.loading-spinner {
    width: 50px;
    height: 50px;
    border: 5px solid #e2e8f0;
    border-top-color: #3b82f6;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}
</style>
</head>
<body>

<!-- TOP HEADER -->
<div class="top-header">
    <h1>üè† SMART DIGITAL NOTICE BOARD ‚Äì HOME</h1>
    <div class="header-controls">
        <button class="refresh-btn" onclick="refreshAll()">
            <span>üîÑ</span>
            <span>REFRESH</span>
        </button>
        <div class="user-info">
            <div class="user-avatar" id="userAvatar">SA</div>
            <div>
                <div class="user-name" id="userName">LOADING...</div>
                <div class="user-role" id="userRole">---</div>
            </div>
        </div>
    </div>
</div>

<!-- MAIN LAYOUT -->
<div class="layout">

    <!-- SIDEBAR -->
    <div class="sidebar">
        <a href="home.html" class="active">
            <span class="sidebar-icon">üè†</span>
            HOME
        </a>
        <a href="dashboard.html">
            <span class="sidebar-icon">üìä</span>
            DASHBOARD
        </a>
        <a href="add-information.html">
            <span class="sidebar-icon">‚ûï</span>
            ADD INFORMATION
        </a>
        <a href="#">
            <span class="sidebar-icon">üìÖ</span>
            SCHEDULE MANAGER
        </a>
        <a href="device-management.html">
            <span>üñ•Ô∏è</span> DISPLAY DEVICES
        </a>
        <a href="settings.html">
            <span class="sidebar-icon">‚öôÔ∏è</span>
            SETTINGS
        </a>
        <a href="#" onclick="logout()">
            <span class="sidebar-icon">üö™</span>
            LOGOUT
        </a>
    </div>

    <!-- PAGE CONTENT -->
    <div class="page-content">

        <!-- FILTER SECTION -->
        <div class="filter-section">
            <div class="filter-title">
                <span>üîç</span>
                <span>SELECT DISPLAY TO VIEW</span>
            </div>
            <div class="filter-grid">
                <div class="filter-group">
                    <label class="filter-label">UNIVERSITY</label>
                    <select class="filter-select" id="filterUniversity" onchange="onUniversityChange()">
                        <option value="">-- Select University --</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">INSTITUTE</label>
                    <select class="filter-select" id="filterInstitute" onchange="onInstituteChange()">
                        <option value="">-- Select Institute --</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">DEPARTMENT</label>
                    <select class="filter-select" id="filterDepartment" onchange="onDepartmentChange()">
                        <option value="">-- Select Department --</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">DISPLAY</label>
                    <select class="filter-select" id="filterDisplay" onchange="onDisplayChange()">
                        <option value="">-- Select Display --</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- STATS ROW -->
        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-icon">üì∫</div>
                <div class="stat-content">
                    <div class="stat-value" id="totalDisplays">0</div>
                    <div class="stat-label">Total Displays</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-content">
                    <div class="stat-value" id="activeContent">0</div>
                    <div class="stat-label">Active Content</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">üìÖ</div>
                <div class="stat-content">
                    <div class="stat-value" id="upcomingCount">0</div>
                    <div class="stat-label">Upcoming Today</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">üåê</div>
                <div class="stat-content">
                    <div class="stat-value" id="onlineDisplays">0</div>
                    <div class="stat-label">Online Displays</div>
                </div>
            </div>
        </div>

        <!-- LIVE DISPLAY PREVIEW -->
        <div class="section">
            <div class="section-title">
                <span>üì∫</span>
                <span>LIVE DISPLAY PREVIEW</span>
            </div>

            <div class="display-preview-container">
                <div class="display-header">
                    <div class="display-name" id="currentDisplayName">Select a display to view</div>
                    <div class="display-status">
                        <div class="status-indicator" id="statusIndicator"></div>
                        <div class="status-text" id="statusText">---</div>
                    </div>
                </div>

                <div class="display-frame" id="displayFrame">
                    <div class="no-data">
                        <div class="no-data-icon">üì∫</div>
                        <div class="no-data-text">No Display Selected</div>
                        <div class="no-data-subtext">Please select a university, institute, department, and display from the filters above</div>
                    </div>
                </div>

                <div class="display-info-bar" id="displayInfoBar" style="display: none;">
                    <div class="info-item">
                        <span class="info-label">Type:</span>
                        <span class="info-value" id="infoType">---</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Duration:</span>
                        <span class="info-value" id="infoDuration">---</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Animation:</span>
                        <span class="info-value" id="infoAnimation">---</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Posted By:</span>
                        <span class="info-value" id="infoPostedBy">---</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- UPCOMING SCHEDULE -->
        <div class="section">
            <div class="section-title">
                <span>üìÖ</span>
                <span>UPCOMING SCHEDULE</span>
            </div>

            <div class="schedule-table-container">
                <table class="schedule-table">
                    <thead>
                        <tr>
                            <th>TIME</th>
                            <th>CONTENT</th>
                            <th>CATEGORY</th>
                            <th>POSTED BY</th>
                            <th>PRIORITY</th>
                            <th>STATUS</th>
                        </tr>
                    </thead>
                    <tbody id="scheduleTableBody">
                        <tr>
                            <td colspan="6" class="loading">
                                <div class="loading-spinner"></div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>

</div>

<!-- FOOTER -->
<div class="footer">
  ¬© 2026 SMART NOTICE BOARD SYSTEM | HSQUARE ELECTRONICS | HEMANT HARLALKA | All Rights Reserved
</div>

<script>
// ============================================
// HOME PAGE JAVASCRIPT - EMBEDDED
// Live Display Preview & Dynamic Filters
// ============================================

//const API_URL = 'http://localhost:5000/api';
const API_URL = '/api';
let currentUser = null;
let allData = {
    universities: [],
    institutes: [],
    departments: [],
    displays: [],
    submissions: []
};

let selectedDisplay = null;
let currentContent = [];
let contentIndex = 0;
let autoPlayInterval = null;

// ===== INITIALIZE =====
window.onload = async function() {
    console.log('üöÄ Initializing Home Page...');
    
    await checkAuth();
    loadUserInfo();
    await loadAllData();
    populateFilters();
    loadStats();
    loadUpcomingSchedule();
    
    console.log('‚úÖ Home page initialized');
};

// ===== AUTHENTICATION =====
async function checkAuth() {
    const userData = localStorage.getItem('user');
    const token = localStorage.getItem('token');
    
    if (!userData || !token) {
        alert('‚ö†Ô∏è Please login first!');
        window.location.href = 'login.html';
        return;
    }
    
    currentUser = JSON.parse(userData);
    console.log('‚úÖ User authenticated:', currentUser.name);
}

function loadUserInfo() {
    if (!currentUser) return;
    
    const initials = currentUser.name.split(' ').map(n => n[0].toUpperCase()).join('');
    document.getElementById('userAvatar').textContent = initials;
    document.getElementById('userName').textContent = currentUser.name.toUpperCase();
    document.getElementById('userRole').textContent = currentUser.role.toUpperCase();
}

// ===== LOAD ALL DATA =====
async function loadAllData() {
    console.log('üì• Loading all data...');
    
    try {
        await Promise.all([
            loadConfigData('universities'),
            loadConfigData('institutes'),
            loadConfigData('departments'),
            loadDisplays(),
            loadSubmissions()
        ]);
        
        console.log('‚úÖ All data loaded');
    } catch (error) {
        console.error('‚ùå Error loading data:', error);
    }
}

async function loadConfigData(endpoint) {
    try {
        const response = await fetch(`${API_URL}/config/${endpoint}`, {
            headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });
        const result = await response.json();
        
        if (result.success) {
            allData[endpoint] = result.data || [];
            console.log(`üì• Loaded ${endpoint}:`, allData[endpoint].length);
        }
    } catch (error) {
        console.error(`Error loading ${endpoint}:`, error);
        allData[endpoint] = [];
    }
}

async function loadDisplays() {
    try {
        const response = await fetch(`${API_URL}/displays`);
        const result = await response.json();
        
        if (result.success) {
            allData.displays = result.data || [];
            console.log('üì• Loaded displays:', allData.displays.length);
        }
    } catch (error) {
        console.error('Error loading displays:', error);
        allData.displays = [];
    }
}

async function loadSubmissions() {
    try {
        const response = await fetch(`${API_URL}/submissions`, {
            headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });
        const result = await response.json();
        
        if (result.success) {
            allData.submissions = result.data || [];
            console.log('üì• Loaded submissions:', allData.submissions.length);
        }
    } catch (error) {
        console.error('Error loading submissions:', error);
        allData.submissions = [];
    }
}

// ===== POPULATE FILTERS =====
function populateFilters() {
    // Populate universities
    const uniSelect = document.getElementById('filterUniversity');
    uniSelect.innerHTML = '<option value="">-- Select University --</option>';
    allData.universities.forEach(uni => {
        uniSelect.innerHTML += `<option value="${uni.id}">${uni.name}</option>`;
    });
    
    // Auto-select if only one university
    if (allData.universities.length === 1) {
        uniSelect.value = allData.universities[0].id;
        onUniversityChange();
    }
}

function onUniversityChange() {
    const uniId = document.getElementById('filterUniversity').value;
    
    // Populate institutes
    const instSelect = document.getElementById('filterInstitute');
    instSelect.innerHTML = '<option value="">-- Select Institute --</option>';
    
    if (!uniId) {
        document.getElementById('filterDepartment').innerHTML = '<option value="">-- Select Department --</option>';
        document.getElementById('filterDisplay').innerHTML = '<option value="">-- Select Display --</option>';
        return;
    }
    
    // For now, show all institutes (can be filtered by university later)
    allData.institutes.forEach(inst => {
        instSelect.innerHTML += `<option value="${inst.id}">${inst.name}</option>`;
    });
}

function onInstituteChange() {
    const instId = document.getElementById('filterInstitute').value;
    
    // Populate departments
    const deptSelect = document.getElementById('filterDepartment');
    deptSelect.innerHTML = '<option value="">-- Select Department --</option>';
    
    if (!instId) {
        document.getElementById('filterDisplay').innerHTML = '<option value="">-- Select Display --</option>';
        return;
    }
    
    const filteredDepts = allData.departments.filter(d => d.instituteId === instId);
    filteredDepts.forEach(dept => {
        deptSelect.innerHTML += `<option value="${dept.id}">${dept.name} (${dept.code})</option>`;
    });
}

function onDepartmentChange() {
    const deptId = document.getElementById('filterDepartment').value;
    
    // Populate displays
    const dispSelect = document.getElementById('filterDisplay');
    dispSelect.innerHTML = '<option value="">-- Select Display --</option>';
    
    if (!deptId) return;
    
    const dept = allData.departments.find(d => d.id === deptId);
    if (!dept) return;
    
    const filteredDisplays = allData.displays.filter(d => 
        d.departmentCode === dept.code || d.departmentCode === dept.departmentCode
    );
    
    filteredDisplays.forEach(disp => {
        dispSelect.innerHTML += `<option value="${disp.displayCode}">${disp.displayName}</option>`;
    });
}

async function onDisplayChange() {
    const displayCode = document.getElementById('filterDisplay').value;
    
    if (!displayCode) {
        clearDisplay();
        return;
    }
    
    selectedDisplay = allData.displays.find(d => d.displayCode === displayCode);
    
    if (!selectedDisplay) return;
    
    // Update display header
    document.getElementById('currentDisplayName').textContent = selectedDisplay.displayName;
    
    const statusIndicator = document.getElementById('statusIndicator');
    const statusText = document.getElementById('statusText');
    
    if (selectedDisplay.status === 'active') {
        statusIndicator.className = 'status-indicator status-online';
        statusText.textContent = 'ONLINE';
    } else {
        statusIndicator.className = 'status-indicator status-offline';
        statusText.textContent = 'OFFLINE';
    }
    
    // Load content for this display
    await loadDisplayContent(displayCode);
}

async function loadDisplayContent(displayCode) {
    try {
        const response = await fetch(`${API_URL}/displays/${displayCode}/content`);
        const result = await response.json();
        
        if (result.success) {
            currentContent = result.content || [];
            console.log('üì• Loaded content for display:', currentContent.length);
            
            if (currentContent.length > 0) {
                contentIndex = 0;
                displayCurrentContent();
                startAutoPlay();
            } else {
                showNoContent();
            }
        }
    } catch (error) {
        console.error('Error loading display content:', error);
        showNoContent();
    }
}

function displayCurrentContent() {
    if (currentContent.length === 0) return;
    
    const content = currentContent[contentIndex];
    const frame = document.getElementById('displayFrame');
    const infoBar = document.getElementById('displayInfoBar');
    
    // Show content based on type
    if (content.contentType === 'image') {
        frame.innerHTML = `
            <img src="${content.fileUrl}" style="max-width: 100%; max-height: 100%; object-fit: contain;" alt="${content.title}">
        `;
    } else if (content.contentType === 'pdf') {
        frame.innerHTML = `
            <div class="display-content">
                <div class="content-placeholder">üìÑ</div>
                <div class="content-title">${content.title}</div>
                <div class="content-description">${content.description || 'PDF Document'}</div>
            </div>
        `;
    } else if (content.contentType === 'video') {
        frame.innerHTML = `
            <video controls autoplay style="max-width: 100%; max-height: 100%;">
                <source src="${content.fileUrl}" type="video/mp4">
            </video>
        `;
    } else {
        frame.innerHTML = `
            <div class="display-content">
                <div class="content-placeholder">üìù</div>
                <div class="content-title">${content.title}</div>
                <div class="content-description">${content.description || ''}</div>
            </div>
        `;
    }
    
    // Update info bar
    document.getElementById('infoType').textContent = content.contentType.toUpperCase();
    document.getElementById('infoDuration').textContent = (content.waitTime || 3) + ' SECONDS';
    document.getElementById('infoAnimation').textContent = 'FADE';
    document.getElementById('infoPostedBy').textContent = content.userName || 'Unknown';
    infoBar.style.display = 'flex';
}

function startAutoPlay() {
    if (autoPlayInterval) clearInterval(autoPlayInterval);
    
    if (currentContent.length <= 1) return;
    
    autoPlayInterval = setInterval(() => {
        contentIndex = (contentIndex + 1) % currentContent.length;
        displayCurrentContent();
    }, (currentContent[contentIndex]?.waitTime || 3) * 1000);
}

function showNoContent() {
    const frame = document.getElementById('displayFrame');
    frame.innerHTML = `
        <div class="no-data">
            <div class="no-data-icon">üì≠</div>
            <div class="no-data-text">No Active Content</div>
            <div class="no-data-subtext">This display has no approved content scheduled for now</div>
        </div>
    `;
    document.getElementById('displayInfoBar').style.display = 'none';
}

function clearDisplay() {
    if (autoPlayInterval) clearInterval(autoPlayInterval);
    
    document.getElementById('currentDisplayName').textContent = 'Select a display to view';
    document.getElementById('statusIndicator').className = 'status-indicator';
    document.getElementById('statusText').textContent = '---';
    
    const frame = document.getElementById('displayFrame');
    frame.innerHTML = `
        <div class="no-data">
            <div class="no-data-icon">üì∫</div>
            <div class="no-data-text">No Display Selected</div>
            <div class="no-data-subtext">Please select a university, institute, department, and display from the filters above</div>
        </div>
    `;
    
    document.getElementById('displayInfoBar').style.display = 'none';
}

// ===== LOAD STATS =====
function loadStats() {
    document.getElementById('totalDisplays').textContent = allData.displays.length;
    
    const activeDisplays = allData.displays.filter(d => d.status === 'active').length;
    document.getElementById('onlineDisplays').textContent = activeDisplays;
    
    const now = new Date();
    const activeContent = allData.submissions.filter(s => {
        if (s.approvalStatus !== 'approved') return false;
        const start = new Date(s.startDate + ' ' + s.startTime);
        const end = new Date(s.endDate + ' ' + s.endTime);
        return now >= start && now <= end;
    }).length;
    document.getElementById('activeContent').textContent = activeContent;
    
    const todayEnd = new Date(now);
    todayEnd.setHours(23, 59, 59);
    const upcomingToday = allData.submissions.filter(s => {
        if (s.approvalStatus !== 'approved') return false;
        const start = new Date(s.startDate + ' ' + s.startTime);
        return start > now && start <= todayEnd;
    }).length;
    document.getElementById('upcomingCount').textContent = upcomingToday;
}

// ===== LOAD UPCOMING SCHEDULE =====
function loadUpcomingSchedule() {
    const tbody = document.getElementById('scheduleTableBody');
    
    const now = new Date();
    const upcoming = allData.submissions.filter(s => {
        if (s.approvalStatus !== 'approved') return false;
        const start = new Date(s.startDate + ' ' + s.startTime);
        return start > now;
    }).sort((a, b) => {
        const aStart = new Date(a.startDate + ' ' + a.startTime);
        const bStart = new Date(b.startDate + ' ' + b.startTime);
        return aStart - bStart;
    }).slice(0, 10); // Show next 10
    
    if (upcoming.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="6" class="no-data">
                    <div class="no-data-icon">üìÖ</div>
                    <div class="no-data-text">No Upcoming Content</div>
                    <div class="no-data-subtext">All scheduled content has been displayed</div>
                </td>
            </tr>
        `;
        return;
    }
    
    tbody.innerHTML = '';
    upcoming.forEach(sub => {
        const startTime = new Date(sub.startDate + ' ' + sub.startTime);
        const timeStr = startTime.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        const dateStr = startTime.toLocaleDateString();
        
        const initials = sub.userName.split(' ').map(n => n[0].toUpperCase()).join('');
        
        const priorityClass = sub.priority === 'emergency' ? 'priority-emergency' :
                             sub.priority === 'important' ? 'priority-important' : 'priority-normal';
        
        const row = `
            <tr>
                <td>
                    <div class="time-badge">${timeStr}</div>
                    <div style="font-size: 12px; color: #64748b; margin-top: 3px;">${dateStr}</div>
                </td>
                <td>
                    <div class="content-name">${sub.title}</div>
                    <div class="content-category">${sub.category}</div>
                </td>
                <td>${sub.category}</td>
                <td>
                    <div class="posted-by">
                        <div class="poster-avatar">${initials}</div>
                        <span>${sub.userName}</span>
                    </div>
                </td>
                <td>
                    <span class="priority-badge ${priorityClass}">${sub.priority || 'normal'}</span>
                </td>
                <td>
                    <span style="color: #f59e0b; font-weight: 600;">‚è≥ Scheduled</span>
                </td>
            </tr>
        `;
        tbody.innerHTML += row;
    });
}

// ===== REFRESH ALL =====
async function refreshAll() {
    console.log('üîÑ Refreshing all data...');
    await loadAllData();
    loadStats();
    loadUpcomingSchedule();
    
    if (selectedDisplay) {
        await loadDisplayContent(selectedDisplay.displayCode);
    }
    
    alert('‚úÖ Data refreshed!');
}

// ===== LOGOUT =====
function logout() {
    if (confirm('üö™ Logout?')) {
        localStorage.clear();
        window.location.href = 'login.html';
    }
}

console.log('‚úÖ home.js loaded');
</script>



</body>
</html>